env:
  global:
  - secure: 0DPb1ibzou9SyBwHDdhbQMlf7kxyaLaaXFeWyvflmWk+6c7BkoOGLEdjC8uSHMX0HCXt0NkRHHUp4qTzTKwV/wX2aVh0DQdQXHQS2nfJeHJtyktsYO5QyfokrahRaX1A9gaCW0kyeElg4D3ah9L0R8HOM0eaO9e5+SZ09dCArGoHonDymQQpxcJ/IPwCiqByba8A1Q721+y4Y/kBZxXl15/UZB6M781goHIHdm/UGcezNM7Oe7gBgXWQu2C+HlR7hxp3rycNxrAX1iuyhesC1uVprprbnsnEVIcWGOo5POLbG79IPrkvVkhKS6sL4a3Xa5kzmlvDnQkFEvFWFpwWoLahdqeXCkfcZ/zN2gnJWauUXrXOqFiHHVr97LMBLG8fveuDECJzrMVPN10rD/cAbt8YXub8XvZ5fV4913JAHl+XB4YDy5KSPCqBG4z9ljRv9gaM022rPFyPKqmBclbK2u/oCXP7lBUWAsuXqsxD69P+Kx8bMrNDuVChWZw4QMOMAAPCq/pi796HCIMYOiAykEuxLqbMbnzFHxsTr+ICdNKQVZ0s7k3eCo8nM8BQnjXqTKu0tDmO0ImdPtjaCIw1AfqYCRTHSWdbbWKlDR9fPJoxYJHsd3h/rcbP0NWbcB1ovA+ESogcKSlHRagVwa51EaWovAQ4ePyY2suiDMkdi8g=
  - secure: qNG3Ni0IvxEJy4RzGWhVR7s2xrXg54qjyaXKaqdmLg4vTvF20LiWGG68sPosrxS98rk6lGL2wTIlsIaLe0MeD6JiF44OO4S8CJfEe2EEEXMXFTI9uV7amYe/kcr8eEdvpFrlUDG+ZnOVYlq6/eYSsew2dqtLj7EyDfSYRvebcbeW1d0aycgjvG2NQyGsjCQzTCCxHcQyHXquwCZWokN5KRWInbQneDPdwlCjq+/DqXtyC3fppXndWdDitUUfGBeHHpb2iIumt3RgHgYpm1FH7T4RrYdxWCrD+krqFNFy9LSg5nuCie4pY1zLeEZ3YrqAsLcBArEHi8k3R3LuJn6xbxh973Omx59A0KQYC/6y6n+1JH0kt41qYFhn0pDsJJbzygGFp6roMYza4IjT/ceY9/4GIGykJInt1Qej/P2C4RCL2S+/ijm53142bmlieEdfTuyjIRg9BGJbzTg8B1D3yMp52jh1YQfvjWNgy81VwKKbf0UmxvOV2Xfgh2jylOldDuwZx9Gg7SDX15ZT+MFDWIQO0LI4FGVMRWS95E2qVqsEN8O+l5n5s0nLXEMk84mPVlWpDZTBC2zoHWr3PepkvJoJmZCOVhoGgqinEpi+NCRfKpE+fLnuy/k9icTQiNLlJNBqJ4/CWhcXUVx4YI01jkYedP9XGw91COWzNVDsFFw=

services:
- docker

addons:
  sonarcloud:
    organization: departement-loire-atlantiqu-1
    token:
      secure: ragbx6x82A4bzYxBg0C9oz6cHnHbPf6dkEtMvN8+IltxoKCO+voUmpIdKE9N1bC2kqNoW2V2igjxbUV4Qh7aqaQRY74XOEpVIBH41J5dZ9gLPcFK++KeUyGW2ND877tpaYz6Wf5uH0ssEXJVJvP9hhE3kPq1eKUgT7UAXckM56MsBpEJ+yyBCTDWlkxyh7RkBIysSKJY4qDrTXC0EbThB2U+hsOTXVRcTj/AoyHmPnqHQ8LwetRjUtqxLP/yMdyZ8sx2Ru9j95NS/k+abanOtImIIwPZmhKkA6Q0eWBUoMUJV6cL2eXlNMHSd/yg+1/aQlUiT/52aWiCLKt26P5DLtWyjj8/b9dAcabOd1Aqyo4dyci7XfXNi4tUYMXKqOvk2Dn9r6V5wR4mKcbf1FyGLDLelbVuDT0curIo+Y4CleBdZKEUTfXx8wUNCz+uEQLjoQdmyaTcYYd+ZNZ9ynkhVVyKzbL3p7FHVX9dfRdrzcBTmQMRlIBc7CZuV3haQpzn3AEwVHXHqk7tbtSGsHRJFdf5YzwJqjx97xfvrBPfqo6XbJwBvagGAuxBYsglm6A8rqCRy3gkBS0/Ud41JPxXSK3uESUDko1OK+UG3gcMaFyFevt3ELkf5yxU924BrtyZ6u3LT0BaiCpwNrJnoWphtbytS1ibHI5p8epoGiAOSsI=

before_script:
- echo "$DOCKER_PASS" | docker login --username $DOCKER_USER --password-stdin
- docker pull julienbayle/jplatformbuild

script:
- docker run -v ${TRAVIS_BUILD_DIR}:/root/source --name buildimage -t julienbayle/jplatformbuild
- docker cp buildimage:/root/dist .
- export CODE_VERSION=`git describe`
- sonar-scanner -Dsonar.projectVersion=$CODE_VERSION

deploy:
  provider: releases
  api_key:
    secure: RhINTdMO38u2yEqhH6867JwOVRwfqf5+Dq4I5K9/jyJ+Z6Zw0RL41zbwWbE7a31vr8CR9Rmb+6ccFb1p4TNFReBWMRRbsbsA45FQ2WUpG6DSxs1NmWXNvdEWbkZb9kxZ7yEg+5LCc1td4BksREhqoLzRRdJIgjl9ASKXWPePOMOjT/xlEH4RxitkwXUH0hwKviTFRzdd9HgtwgpTnHGfH8l8YJu0LjWJzC7S8Ltxz8nnI0L+2WMwaW3GlTISsU8HBVMcQ5AH7VpTQVkvVPz7r0cTjgkOWqbfs8YFJhj9ue3kHfEynM28flvUuJ7v11wBE3kiR9oNl/9+k1r3SG/0zAYA6EFeZePN1Ho3Pj6KeU5r/oFsEdBZ4CjrUG05YGfyBfdND9XVMoqbBHcvH75Psiof+JmdOBRvKxRxrrLAtuhMvnctoyGwTxHMeHKKt56TqQI+gsdUzjCbltPrlX/usuaDRrhP+0gZS1KfSYjWRm5/js5Ouh/HQgTqDQpOe2GrenDlJwspYsAU+6BbLP4mxxTEkd21veWJRU5qj0NfXd6jWFVYxzSsOGEcpfYN7ZlpM/QLQvGs4YLhnqmh+gP6FA2oXpl/MLYYKG5nu6APvAXTaYQ1BseI+3CBbFVIuhRrIsW4/VK4+TbAuhl1067grGibuhCD3cAw8tRJOcjz9Vg=
  file: "${TRAVIS_BUILD_DIR}/dist/*.zip"
  skip_cleanup: true
  on:
    tags: true
