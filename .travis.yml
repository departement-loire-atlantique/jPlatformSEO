env:
  global:
  - secure: YWUVOtDuTMEc4i4mG63NlsyKlEIIsyUOMAYq8OVewe4w5GW7OyK7oYTl9aqFR72QuqvmDlU6NpNBWDN0MznJ9/pNEQW43bv1OCDceVGOfvHuq3znvIZ0vyv6gNLK8Xiebly0/NYX+SkQ4D3eSj8qxjpbiQqYiJDHnrQO+dMKXx+xrgfc+opCL35uvAZgIl1NEd7q+2xt/KgxNZip60DcQkDA3HJhbe034hWQvygAU13v70g4Q3iXO6dEyJ2ZI7yWsrU/krMF7GryT27djo1IcgT2N/vBXLesLncHetXOXbukGNVHiC2vmNyBM927jorrI3+oab87nV+iC6pXheMaRLTlkYT4JKiA9H2Bs4o3Uc8yfkO1oWMu+vru+m22NKZn2hikjTvIaK5GhZtXbvPgmA8NrFE9IBrxpzw0+ogQjO3IjJ1QxbMl4O3dCgTYpt2eO5v1ow5JU1cQk6Ol+fZgK23bwqBYFlFW0nMD7+VqtX6D9HDZ5VBnuwS5lhlF2zN+pe4+0i2DoPe8ZShf7aC9aHnAAG5bpxl2O0uS9hA1joSzs71+xEmoAicCw2WrONF/rjPohzHXhV4WPybSbBuk2yhx1hAZI7X56E6ZkBmim8ORz6fzEWPC6Yb5izHBNSkCJou1T0Pyw9o+3HWkm6f/+4rKgY3/lEFoiqxbdwZsbQo=
  - secure: unX4lkq56EBD8ZWbezvJF4PCQwR4+2v9PHWubd6g43oBsdX+RtXkUv7YjmAhJt5WeBboAweMyqcsV8yytNR34ob0VCtfM9yg79NBeeC2JB9eZdNVmZ1IvdOlEPHV6umG9C5USCKTEDm3XaHXGj2iSXyT2qlk8DDntBoVRhzgK0ezfzj77lxr235cZ6uyxR0f6SWgO1dSYkMveCCv3nsU02HIIt1pu1sBt8GbAjeG9DYgdZvZG8OUKbTygah+c5WmFog+nZ6Fdq9lhKVmSCwzHC0fRBZtpIJaWdPEL/XVMvonq87vbn7BC0TocLXSs36s2XNjwhoev8yL8M7VkYycNRmroZSQpbqjYKPwK/ocPAswxyQRSyFtxdqSLoIx5epql182MKGWyELRt6SHhi7G8Vuokp3Altsu4yoe+d1Bqsi76CZSmOuKyAO89xpHx2RQ5u5HQJ6pFsMV8HGqDnz9xkkSy/H+RxU2OVCRG7CjlvICACN97sxm7Weblp1GGGssi9HEkzazVpI7Vje+zy05bY/6envoHTLMADdWG/hxOedXt/Jr31LeJBKOQYqwzONoF2gwkkRsqN82h85Z89+54oFOBt/oCnv2R9KlwUvRrrzLxvLQd/dwO83Jz5/0hH/ylW41B+C2xIatA0qE+Vk64EBdFpYNzYsBDx+P2M2wzE0=

services:
- docker

addons:
  sonarcloud:
    organization: departement-loire-atlantiqu-1
    token:
      secure: ragbx6x82A4bzYxBg0C9oz6cHnHbPf6dkEtMvN8+IltxoKCO+voUmpIdKE9N1bC2kqNoW2V2igjxbUV4Qh7aqaQRY74XOEpVIBH41J5dZ9gLPcFK++KeUyGW2ND877tpaYz6Wf5uH0ssEXJVJvP9hhE3kPq1eKUgT7UAXckM56MsBpEJ+yyBCTDWlkxyh7RkBIysSKJY4qDrTXC0EbThB2U+hsOTXVRcTj/AoyHmPnqHQ8LwetRjUtqxLP/yMdyZ8sx2Ru9j95NS/k+abanOtImIIwPZmhKkA6Q0eWBUoMUJV6cL2eXlNMHSd/yg+1/aQlUiT/52aWiCLKt26P5DLtWyjj8/b9dAcabOd1Aqyo4dyci7XfXNi4tUYMXKqOvk2Dn9r6V5wR4mKcbf1FyGLDLelbVuDT0curIo+Y4CleBdZKEUTfXx8wUNCz+uEQLjoQdmyaTcYYd+ZNZ9ynkhVVyKzbL3p7FHVX9dfRdrzcBTmQMRlIBc7CZuV3haQpzn3AEwVHXHqk7tbtSGsHRJFdf5YzwJqjx97xfvrBPfqo6XbJwBvagGAuxBYsglm6A8rqCRy3gkBS0/Ud41JPxXSK3uESUDko1OK+UG3gcMaFyFevt3ELkf5yxU924BrtyZ6u3LT0BaiCpwNrJnoWphtbytS1ibHI5p8epoGiAOSsI=

before_script:
- echo "$DOCKER_PASS" | docker login --username $DOCKER_USER --password-stdin
- docker pull asfram/jplatformbuild

script:
- docker run -v ${TRAVIS_BUILD_DIR}:/root/source --name buildimage -t asfram/jplatformbuild
- docker cp buildimage:/root/dist ${TRAVIS_BUILD_DIR}/
- export FILE_NAME=`ls ${TRAVIS_BUILD_DIR}/dist/*.zip`
- export CODE_VERSION=`git describe`
- sonar-scanner -Dsonar.projectVersion=$CODE_VERSION

deploy:
  provider: releases
  api_key:
    secure: NzuKuebnWpNIysU9ABtmVlX0VjsWqpy7YUilwnyaIL8hQ65wkA2nRRb2vdDh2AymgDsStO93SCepnO8YDpwmMyda/zgrt1TBJhpU1pSfqfUr+8rXCWgNOXcX5eoqOsolGemapHZ1AqeTmxfZr3RugZe0IENVhktL11guWibhF58PlaKH9/T6fZJxTW2Cr86wVYCxNX8t8KnS+hWwxCJ2X+F1+GUqeE06vUmKFZPUaH5utuVcKres/oJ9LUtY3noYvBDdq+8g+3M0q/2bTpIRMvo7ujv10Q16dOB1T4qcZtTFxsSjUb9h3H5AuQL66QSbh1Lbir50zwdpPpEMt85iujsZZzujVZYsGPYXAHy/Wt7NgvWjPWCbJllbIvLuY8AncvnbFzIgq7MH/ZrbleRM/z3W1qLZuUspQ/23qJN0YBh9WT8LpE3D630+i1FvAqgWBm8gIpLrRGADJSNt+HeJlPJCXI4GgHZsB0E+1drOEJeutpvWeLqIIPiRfszJDVCibDw/GOcYzeRx690nt4BqwEeU7nUh0Fd6GBgmyAMsMKQ58oScdHV6r/4q6Nu54b+LuxpBPDd2bSYk0w1NMSvQgNlDwRIEff4MoJ+Z37NDHmRYZV4rdItcHxFX6TOTG+VNV3U/dO1t8CGNYx7TWy9YQ3KYGUozncap5InNZUyEVxM=
  file: "${FILE_NAME}"
  skip_cleanup: true
  on:
    tags: true
